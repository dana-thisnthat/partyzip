<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Partyzip Â· ì´ˆëŒ€ì¥ ë§Œë“¤ê¸°</title>
  <style>
    :root{
      --bg:#050816; --card:#0b1220; --bd:#1f2937;
      --txt:#e5e7eb; --muted:#9ca3af; --acc:#f97316;
    }
    *{box-sizing:border-box}
    body{
      margin:0;font-family:system-ui,-apple-system,Segoe UI,sans-serif;color:var(--txt);
      background: radial-gradient(circle at top, #111827 0, #020617 45%, #000 100%);
    }
    .wrap{max-width:560px;margin:0 auto;padding:16px 16px 40px}
    .top{
      display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:10px
    }
    .brand{font-weight:800;letter-spacing:-.3px}
    .chip{
      font-size:12px;color:var(--muted);border:1px solid rgba(148,163,184,.35);
      padding:6px 10px;border-radius:999px
    }
    h1{margin:10px 0 6px;font-size:18px}
    p{margin:0;color:var(--muted);font-size:13px;line-height:1.45}
    .card{
      margin-top:12px;background:rgba(11,18,32,.96);border:1px solid var(--bd);
      border-radius:16px;padding:12px
    }
    label{display:block;font-size:12px;color:var(--muted);margin:10px 0 6px}
    input, textarea{
      width:100%;border-radius:12px;border:1px solid #374151;background:#020617;color:var(--txt);
      padding:11px 12px;font-size:14px;outline:none
    }
    textarea{min-height:78px;resize:vertical}
    input:focus,textarea:focus{border-color:var(--acc);box-shadow:0 0 0 1px rgba(249,115,22,.35)}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .row > *{flex:1 1 200px}
    .btnrow{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
    .btn{
      border:0;border-radius:999px;padding:11px 14px;font-size:14px;cursor:pointer;
      display:inline-flex;align-items:center;justify-content:center;gap:6px;flex:1 1 160px
    }
    .primary{background:linear-gradient(135deg,#f97316,#facc15);color:#111827;font-weight:800}
    .ghost{background:transparent;border:1px solid #4b5563;color:var(--txt)}
    .danger{background:transparent;border:1px solid rgba(251,113,133,.8);color:#fb7185}
    .hint{font-size:12px;color:var(--muted);margin-top:6px}

    /* theme picker (swipe/scroll) */
    .themes{
      display:flex;gap:10px;overflow-x:auto;padding-bottom:6px;scroll-snap-type:x mandatory;
    }
    .theme{
      flex:0 0 78%; scroll-snap-align:start;
      border-radius:16px;border:1px solid rgba(148,163,184,.3);
      padding:12px; background:#020617; position:relative; cursor:pointer;
      min-height:110px;
    }
    .theme input{display:none}
    .theme .name{font-weight:800;margin-bottom:4px}
    .theme .desc{font-size:12px;color:var(--muted);line-height:1.4}
    .theme.selected{border-color:var(--acc);box-shadow:0 0 0 1px rgba(249,115,22,.35)}
    .bg-xmas{background: radial-gradient(circle at top, rgba(74,222,128,.18), rgba(2,6,23,.95));}
    .bg-snow{background: radial-gradient(circle at top, rgba(191,219,254,.18), rgba(2,6,23,.95));}
    .bg-newyear{background: radial-gradient(circle at top, rgba(251,191,36,.18), rgba(2,6,23,.95));}

    /* invite preview */
    .preview{
      margin-top:10px;border-radius:18px;border:1px solid rgba(148,163,184,.35);
      overflow:hidden
    }
    .previewHead{
      padding:14px 14px 10px;
      display:flex;justify-content:space-between;align-items:flex-start;gap:10px
    }
    .dday{
      font-size:12px;border-radius:999px;padding:6px 10px;
      border:1px solid rgba(148,163,184,.35);color:#fed7aa;background:rgba(15,23,42,.6)
    }
    .title{font-weight:900;letter-spacing:-.2px}
    .subtitle{margin-top:4px;color:#cbd5f5;font-size:13px}
    .previewBody{padding:0 14px 14px;color:#e5e7eb;font-size:13px}
    .meta{margin-top:8px;color:#e5e7eb}
    .meta .muted{color:var(--muted)}
    .toast{
      position:fixed;left:50%;bottom:18px;transform:translateX(-50%);
      background:rgba(15,23,42,.95);border:1px solid rgba(148,163,184,.6);
      padding:7px 12px;border-radius:999px;font-size:12px;opacity:0;transition:opacity .2s;
      pointer-events:none;z-index:50
    }
    .toast.show{opacity:1}

    a{color:#fed7aa}
  </style>
</head>
<body>
<div class="wrap">
  <div class="top">
    <div class="brand">Partyzip</div>
    <div class="chip">íŒŒí‹° ì½”ë“œ: <span id="codeText">-</span></div>
  </div>

  <h1>íŒŒí‹° ì´ˆëŒ€ì¥ì„ ë§Œë“¤ì–´ìš”</h1>
  <p>ë”± í•„ìš”í•œ ì •ë³´ë§Œ ì…ë ¥í•˜ë©´ ë. ë§í¬ë¡œ ê³µìœ í•˜ê³ , íŒŒí‹° ë‹¹ì¼ì—” ìë™ìœ¼ë¡œ â€œíŒŒí‹° ëª¨ë“œâ€ë¡œ ì´ì–´ì ¸ìš”.</p>

  <div class="card">
    <label>í…Œë§ˆë¥¼ ê³ ë¥´ì„¸ìš” (ì¢Œìš°ë¡œ ìŠ¤ì™€ì´í”„)</label>
    <div class="themes" id="themes">
      <div class="theme bg-xmas" data-theme="xmas">
        <div class="name">í¬ë¦¬ìŠ¤ë§ˆìŠ¤ ë¬´ë“œ</div>
        <div class="desc">ë”°ëœ»í•œ ì—°ë§ ë¶„ìœ„ê¸°. ì´ˆëŒ€ì¥ì— ê°€ì¥ ë¬´ë‚œí•´ìš”.</div>
      </div>
      <div class="theme bg-snow" data-theme="snow">
        <div class="name">ëˆˆ ë‚´ë¦¬ëŠ” ë¬´ë“œ</div>
        <div class="desc">ì‹œì›í•œ í†¤. ì‹¬í”Œí•œ ëª¨ì„ì—ë„ ì˜ ë§ì•„ìš”.</div>
      </div>
      <div class="theme bg-newyear" data-theme="newyear">
        <div class="name">í•´í”¼ ë‰´ì´ì–´</div>
        <div class="desc">ì¹´ìš´íŠ¸ë‹¤ìš´ ëŠë‚Œ. ì—°ë§Â·ì—°ì´ˆì— ë”±ì´ì—ìš”.</div>
      </div>
    </div>

    <label>íŒŒí‹° ì´ë¦„</label>
    <input id="title" placeholder="Goodbye 2025 & Welcome 2026" />

    <label>í•œ ì¤„ ë©”ì‹œì§€ (ì„ íƒ)</label>
    <input id="subtitle" placeholder="ì˜ˆ: ì˜¬í•´ë„ ê°™ì´ ë³´ë‚´ì¤˜ì„œ ê³ ë§ˆì›Œ ğŸ¥‚" />

    <div class="row">
      <div>
        <label>ì‹œì‘ ë‚ ì§œ</label>
        <input id="startDate" type="date" />
      </div>
      <div>
        <label>ì‹œì‘ ì‹œê°„</label>
        <input id="startTime" type="time" />
      </div>
    </div>

    <div class="row">
      <div>
        <label>ì¢…ë£Œ ë‚ ì§œ (ì„ íƒ)</label>
        <input id="endDate" type="date" />
      </div>
      <div>
        <label>ì¢…ë£Œ ì‹œê°„ (ì„ íƒ)</label>
        <input id="endTime" type="time" />
      </div>
    </div>

    <label>ì¥ì†Œ</label>
    <input id="location" placeholder="ì˜ˆ: â—‹â—‹êµ¬ â—‹â—‹ë¡œ 123, â—‹â—‹íŒŒí‹°ë£¸ 502í˜¸" />

    <label>ì¶”ê°€ ì•ˆë‚´ (ì„ íƒ)</label>
    <textarea id="note" placeholder="ì˜ˆ: ì¤€ë¹„ë¬¼ / íŒŒí‹° íƒ€ì„ë¼ì¸ / ìˆ™ì†Œ ë¹„ë°€ë²ˆí˜¸ / ì£¼ì°¨ ì•ˆë‚´ ë“±"></textarea>

    <div class="btnrow">
      <button class="btn primary" id="btnMake">ì´ˆëŒ€ì¥ ë§Œë“¤ê¸°</button>
      <button class="btn ghost" id="btnShare">ê³µìœ í•˜ê¸°</button>
      <button class="btn ghost" id="btnSaveImg">ì €ì¥í•˜ê¸°</button>
      <button class="btn danger" id="btnGoIntro">Introë¡œ</button>
    </div>
    <div class="hint">â€» â€œì €ì¥í•˜ê¸°â€ëŠ” ì´ í™”ë©´(ì´ˆëŒ€ì¥)ì„ ì´ë¯¸ì§€ë¡œ ì €ì¥í•©ë‹ˆë‹¤. (í”„ë¡œí† íƒ€ì…ìš©)</div>
  </div>

  <div class="card" id="previewWrap" style="display:none;">
    <label style="margin-top:0;">ì´ˆëŒ€ì¥ ë¯¸ë¦¬ë³´ê¸°</label>
    <div class="preview" id="inviteCard">
      <div class="previewHead">
        <div>
          <div class="title" id="pTitle">-</div>
          <div class="subtitle" id="pSubtitle" style="display:none;"></div>
        </div>
        <div class="dday" id="dday">D-?</div>
      </div>
      <div class="previewBody">
        <div class="meta"><span class="muted">â°</span> <span id="pWhen">-</span></div>
        <div class="meta"><span class="muted">ğŸ“</span> <span id="pWhere">-</span></div>
        <div class="meta" id="pNoteWrap" style="display:none;margin-top:10px;">
          <div class="muted" style="margin-bottom:4px;">ì¶”ê°€ ì•ˆë‚´</div>
          <div id="pNote" style="white-space:pre-line;"></div>
        </div>
      </div>
    </div>
    <div class="hint">ë§í¬ë¡œ ë“¤ì–´ì˜¤ë©´ ì´ ì´ˆëŒ€ì¥ì´ ê¸°ë³¸ìœ¼ë¡œ ë³´ì´ê³ , ë‚ ì§œê°€ ë˜ë©´ íŒŒí‹° ì¤‘ í˜ì´ì§€ë¡œ ë„˜ì–´ê°€ìš”.</div>
  </div>

  <div class="toast" id="toast">ì•ˆë‚´</div>
</div>

<!-- html2canvas: ì´ë¯¸ì§€ ì €ì¥ìš©(ì •ì  ë°°í¬ ì‹œ ë™ì‘) -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script>
  // ===== Storage =====
  const KEY="partyzip_parties_v1";
  function loadAll(){ try{ return JSON.parse(localStorage.getItem(KEY)||"{}"); }catch(e){ return {}; } }
  function saveAll(o){ localStorage.setItem(KEY, JSON.stringify(o)); }

  function toast(msg){
    const t=document.getElementById("toast");
    t.textContent=msg; t.classList.add("show");
    setTimeout(()=>t.classList.remove("show"), 1600);
  }

  function qs(name){
    const u=new URL(location.href);
    return u.searchParams.get(name);
  }

  function themeClass(theme){
    if(theme==="snow") return "bg-snow";
    if(theme==="newyear") return "bg-newyear";
    return "bg-xmas";
  }

  function setInviteBg(theme){
    const card=document.getElementById("inviteCard");
    card.classList.remove("bg-xmas","bg-snow","bg-newyear");
    card.classList.add(themeClass(theme));
    card.style.background = ""; // handled by class
  }

  function calcDDay(startDate){
    if(!startDate) return "D-?";
    const today=new Date(); today.setHours(0,0,0,0);
    const target=new Date(startDate+"T00:00:00"); target.setHours(0,0,0,0);
    const diff=Math.round((target-today)/(1000*60*60*24));
    if(diff>0) return "D-"+diff;
    if(diff===0) return "D-Day";
    return "D+"+Math.abs(diff);
  }

  function routeByDate(party){
    const today=new Date(); today.setHours(0,0,0,0);
    const start=party.startDate ? new Date(party.startDate+"T00:00:00") : null;
    if(!start) return "before.html";
    start.setHours(0,0,0,0);
    const diff=Math.round((start-today)/(1000*60*60*24));
    if(diff>0) return "before.html";
    if(diff===0) return "party.html";
    return "after.html";
  }

  // ===== Init =====
  const code = (qs("code")||"").toUpperCase();
  document.getElementById("codeText").textContent = code || "-";

  const all = loadAll();
  const party = all[code];
  if(!code || !party){
    toast("íŒŒí‹° ì½”ë“œë¥¼ ì°¾ì§€ ëª»í–ˆì–´. Introë¡œ ì´ë™í• ê²Œ");
    setTimeout(()=> location.href="index.html", 900);
  } else {
    // mark last
    party.last="before"; all[code]=party; saveAll(all);
    // hydrate form
    document.getElementById("title").value = party.title || "";
    document.getElementById("subtitle").value = party.subtitle || "";
    document.getElementById("startDate").value = party.startDate || "";
    document.getElementById("startTime").value = party.startTime || "";
    document.getElementById("endDate").value = party.endDate || "";
    document.getElementById("endTime").value = party.endTime || "";
    document.getElementById("location").value = party.location || "";
    document.getElementById("note").value = party.note || "";

    // select theme
    document.querySelectorAll(".theme").forEach(el=>{
      el.classList.toggle("selected", el.dataset.theme === (party.theme||"xmas"));
    });
  }

  // theme click
  document.querySelectorAll(".theme").forEach(el=>{
    el.addEventListener("click", ()=>{
      document.querySelectorAll(".theme").forEach(x=>x.classList.remove("selected"));
      el.classList.add("selected");
      if(code && all[code]){
        all[code].theme = el.dataset.theme;
        saveAll(all);
      }
      toast("í…Œë§ˆë¥¼ ì„ íƒí–ˆì–´");
    });
  });

  // make invite
  document.getElementById("btnMake").addEventListener("click", ()=>{
    if(!code || !all[code]) return;

    const theme = document.querySelector(".theme.selected")?.dataset.theme || "xmas";
    const title = document.getElementById("title").value.trim();
    const startDate = document.getElementById("startDate").value;
    const startTime = document.getElementById("startTime").value;
    const locationTxt = document.getElementById("location").value.trim();

    if(!theme) return toast("í…Œë§ˆë¥¼ ê³¨ë¼ì¤˜");
    if(!title) return toast("íŒŒí‹° ì´ë¦„ì„ ì…ë ¥í•´ì¤˜");
    if(!startDate || !startTime) return toast("ì‹œì‘ ë‚ ì§œ/ì‹œê°„ì„ ì…ë ¥í•´ì¤˜");
    if(!locationTxt) return toast("ì¥ì†Œë¥¼ ì…ë ¥í•´ì¤˜");

    all[code] = {
      ...all[code],
      theme,
      title,
      subtitle: document.getElementById("subtitle").value.trim(),
      startDate,
      startTime,
      endDate: document.getElementById("endDate").value,
      endTime: document.getElementById("endTime").value,
      location: locationTxt,
      note: document.getElementById("note").value.trim(),
      last: "before"
    };
    saveAll(all);

    // render preview
    document.getElementById("previewWrap").style.display = "";
    document.getElementById("pTitle").textContent = all[code].title;
    const sub = all[code].subtitle;
    const subEl = document.getElementById("pSubtitle");
    if(sub){ subEl.style.display=""; subEl.textContent=sub; }
    else { subEl.style.display="none"; }

    document.getElementById("pWhen").textContent =
      `${all[code].startDate.replaceAll("-",".")} ${all[code].startTime}` +
      (all[code].endDate && all[code].endTime ? ` ~ ${all[code].endDate.replaceAll("-",".")} ${all[code].endTime}` : "");

    document.getElementById("pWhere").textContent = all[code].location;

    const note = all[code].note;
    const noteWrap = document.getElementById("pNoteWrap");
    if(note){ noteWrap.style.display=""; document.getElementById("pNote").textContent = note; }
    else { noteWrap.style.display="none"; }

    document.getElementById("dday").textContent = calcDDay(all[code].startDate);
    setInviteBg(all[code].theme);

    toast("ì´ˆëŒ€ì¥ ë§Œë“¤ê¸° ì™„ë£Œ");
  });

  // share
  document.getElementById("btnShare").addEventListener("click", async ()=>{
    if(!code) return;
    const url = `${location.origin}${location.pathname.replace("before.html","before.html")}?code=${encodeURIComponent(code)}`;
    try{
      await navigator.clipboard.writeText(url);
      toast("ë§í¬ë¥¼ ë³µì‚¬í–ˆì–´");
    }catch(e){
      // fallback
      const ta=document.createElement("textarea"); ta.value=url;
      document.body.appendChild(ta); ta.select(); document.execCommand("copy"); document.body.removeChild(ta);
      toast("ë§í¬ë¥¼ ë³µì‚¬í–ˆì–´");
    }
  });

  // save image (invite)
  document.getElementById("btnSaveImg").addEventListener("click", async ()=>{
    const wrap = document.getElementById("previewWrap");
    if(wrap.style.display==="none") return toast("ë¨¼ì € ì´ˆëŒ€ì¥ì„ ë§Œë“¤ì–´ì¤˜");
    const card = document.getElementById("inviteCard");
    const canvas = await html2canvas(card, {backgroundColor:null, scale:2});
    const a=document.createElement("a");
    a.download = `partyzip-invite-${code}.png`;
    a.href = canvas.toDataURL("image/png");
    a.click();
    toast("ì´ë¯¸ì§€ë¡œ ì €ì¥í–ˆì–´");
  });

  // intro
  document.getElementById("btnGoIntro").addEventListener("click", ()=> location.href="index.html");

  // auto route if date reached (ë‹¨ìˆœ ì²´í¬)
  window.setInterval(()=>{
    if(!code || !all[code]) return;
    const next = routeByDate(all[code]);
    if(next !== "before.html"){
      location.href = `${next}?code=${encodeURIComponent(code)}`;
    } else {
      // keep D-day live
      const d = all[code].startDate;
      const el=document.getElementById("dday");
      if(el && d) el.textContent = calcDDay(d);
    }
  }, 30000);
</script>
</body>
</html>
