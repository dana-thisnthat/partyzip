<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Partyzip Â· ë°©ëª…ë¡</title>
  <style>
    :root{
      --bg:#050816; --card:#0b1220; --bd:#1f2937;
      --txt:#e5e7eb; --muted:#9ca3af; --acc:#f97316;
    }
    *{box-sizing:border-box}
    body{
      margin:0;font-family:system-ui,-apple-system,Segoe UI,sans-serif;color:var(--txt);
      background: radial-gradient(circle at top, #111827 0, #020617 45%, #000 100%);
    }
    .wrap{max-width:560px;margin:0 auto;padding:16px 16px 40px}
    .top{display:flex;justify-content:space-between;align-items:center;gap:10px}
    .brand{font-weight:900}
    .chip{font-size:12px;color:var(--muted);border:1px solid rgba(148,163,184,.35);padding:6px 10px;border-radius:999px}
    h1{margin:10px 0 4px;font-size:18px}
    p{margin:0;color:var(--muted);font-size:13px;line-height:1.45}
    .card{margin-top:12px;background:rgba(11,18,32,.96);border:1px solid var(--bd);border-radius:16px;padding:12px}
    label{display:block;font-size:12px;color:var(--muted);margin:10px 0 6px}
    input, textarea{
      width:100%;border-radius:12px;border:1px solid #374151;background:#020617;color:var(--txt);
      padding:11px 12px;font-size:14px;outline:none
    }
    textarea{min-height:70px;resize:vertical}
    input:focus,textarea:focus{border-color:var(--acc);box-shadow:0 0 0 1px rgba(249,115,22,.35)}
    .btnrow{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
    .btn{
      border:0;border-radius:999px;padding:11px 14px;font-size:14px;cursor:pointer;
      display:inline-flex;align-items:center;justify-content:center;gap:6px;flex:1 1 160px
    }
    .primary{background:linear-gradient(135deg,#f97316,#facc15);color:#111827;font-weight:900}
    .ghost{background:transparent;border:1px solid #4b5563;color:var(--txt)}
    .hint{font-size:12px;color:var(--muted);margin-top:6px}
    .board{
      margin-top:10px;border-radius:18px;border:1px solid rgba(148,163,184,.35);
      overflow:hidden;padding:12px
    }
    .entry{padding:10px 0;border-bottom:1px dashed rgba(148,163,184,.35)}
    .entry:last-child{border-bottom:0}
    .name{font-weight:900}
    .msg{color:#cbd5f5;margin-top:4px;white-space:pre-line}
    .empty{color:var(--muted);font-size:13px}
    .toast{
      position:fixed;left:50%;bottom:18px;transform:translateX(-50%);
      background:rgba(15,23,42,.95);border:1px solid rgba(148,163,184,.6);
      padding:7px 12px;border-radius:999px;font-size:12px;opacity:0;transition:opacity .2s;
      pointer-events:none;z-index:50
    }
    .toast.show{opacity:1}

    /* theme backgrounds */
    .bg-xmas{background: radial-gradient(circle at top, rgba(74,222,128,.18), rgba(2,6,23,.95));}
    .bg-snow{background: radial-gradient(circle at top, rgba(191,219,254,.18), rgba(2,6,23,.95));}
    .bg-newyear{background: radial-gradient(circle at top, rgba(251,191,36,.18), rgba(2,6,23,.95));}
  </style>
</head>
<body>
<div class="wrap">
  <div class="top">
    <div class="brand">Partyzip</div>
    <div class="chip">ì½”ë“œ: <span id="codeText">-</span></div>
  </div>

  <h1 id="title">ë°©ëª…ë¡</h1>
  <p>í•œ ì¤„ì”© ë‚¨ê¸°ê³ , ì €ì¥í•´ì„œ ë‹¨í†¡ë°©ì— ê³µìœ í•˜ì„¸ìš”.</p>

  <div class="card">
    <label>ë‹‰ë„¤ì„</label>
    <input id="name" placeholder="ì˜ˆ: ë‹¤ë‚˜" />
    <label>ë©”ì‹œì§€</label>
    <textarea id="msg" placeholder="ì˜ˆ: ì˜¤ëŠ˜ ë„ˆë¬´ ì¢‹ì•˜ë‹¤! ë‹¤ìŒì—ë„ ê¼­ ì´ ë©¤ë²„ë¡œ ë˜ ëª¨ì´ì ğŸ¥‚"></textarea>
    <div class="btnrow">
      <button class="btn primary" id="btnAdd">ë°©ëª…ë¡ì— ì¶”ê°€</button>
    </div>
    <div class="hint">â€» ê¸°ê¸° ë‚´ ì €ì¥(í”„ë¡œí† íƒ€ì…). ì •ì‹ ë²„ì „ì€ ì—¬ëŸ¬ ì‚¬ëŒì´ í•¨ê»˜ ì‘ì„±í•˜ë„ë¡ ì„œë²„ ì €ì¥ì´ í•„ìš”í•´ìš”.</div>
  </div>

  <div class="card">
    <label style="margin-top:0;">ë¡¤ë§í˜ì´í¼</label>
    <div class="board" id="board">
      <div class="empty">ì•„ì§ ë©”ì‹œì§€ê°€ ì—†ì–´ìš”. ì²« ì¤„ì„ ë‚¨ê²¨ë³´ì„¸ìš”.</div>
    </div>
    <div class="btnrow" style="margin-top:12px">
      <button class="btn ghost" id="btnShare">ê³µìœ í•˜ê¸°</button>
      <button class="btn ghost" id="btnSaveImg">ì €ì¥í•˜ê¸°</button>
    </div>
  </div>

  <div class="toast" id="toast">ì•ˆë‚´</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script>
  const KEY="partyzip_parties_v1";
  function loadAll(){ try{ return JSON.parse(localStorage.getItem(KEY)||"{}"); }catch(e){ return {}; } }
  function saveAll(o){ localStorage.setItem(KEY, JSON.stringify(o)); }
  function qs(name){ return new URL(location.href).searchParams.get(name); }
  function toast(msg){
    const t=document.getElementById("toast");
    t.textContent=msg; t.classList.add("show");
    setTimeout(()=>t.classList.remove("show"), 1500);
  }
  function themeClass(theme){
    if(theme==="snow") return "bg-snow";
    if(theme==="newyear") return "bg-newyear";
    return "bg-xmas";
  }

  const code=(qs("code")||"").toUpperCase();
  document.getElementById("codeText").textContent=code||"-";
  const all=loadAll();
  const party=all[code];
  if(!code || !party){
    toast("íŒŒí‹° ì½”ë“œë¥¼ ì°¾ì§€ ëª»í–ˆì–´. Introë¡œ ì´ë™í• ê²Œ");
    setTimeout(()=>location.href="index.html",900);
  } else {
    party.last="after"; all[code]=party; saveAll(all);
    document.getElementById("title").textContent = party.title ? `${party.title} Â· ë°©ëª…ë¡` : "ë°©ëª…ë¡";
  }

  // guestbook is stored per code (local)
  const GKEY = `partyzip_guestbook_${code}`;
  function loadBook(){ try{ return JSON.parse(localStorage.getItem(GKEY)||"[]"); }catch(e){ return []; } }
  function saveBook(arr){ localStorage.setItem(GKEY, JSON.stringify(arr)); }

  function render(){
    const board=document.getElementById("board");
    board.classList.remove("bg-xmas","bg-snow","bg-newyear");
    board.classList.add(themeClass(party?.theme || "xmas"));

    const entries=loadBook();
    board.innerHTML="";
    if(!entries.length){
      const div=document.createElement("div");
      div.className="empty";
      div.textContent="ì•„ì§ ë©”ì‹œì§€ê°€ ì—†ì–´ìš”. ì²« ì¤„ì„ ë‚¨ê²¨ë³´ì„¸ìš”.";
      board.appendChild(div);
      return;
    }
    entries.forEach(e=>{
      const wrap=document.createElement("div");
      wrap.className="entry";
      const n=document.createElement("div");
      n.className="name";
      n.textContent=e.name || "ìµëª…";
      const m=document.createElement("div");
      m.className="msg";
      m.textContent=e.msg || "";
      wrap.appendChild(n); wrap.appendChild(m);
      board.appendChild(wrap);
    });
  }

  document.getElementById("btnAdd").addEventListener("click", ()=>{
    const name=document.getElementById("name").value.trim() || "ìµëª…";
    const msg=document.getElementById("msg").value.trim();
    if(!msg) return toast("ë©”ì‹œì§€ë¥¼ ì…ë ¥í•´ì¤˜");
    const entries=loadBook();
    entries.push({name, msg, ts: Date.now()});
    saveBook(entries);
    document.getElementById("msg").value="";
    render();
    toast("ì¶”ê°€í–ˆì–´");
  });

  document.getElementById("btnShare").addEventListener("click", async ()=>{
    if(!code) return;
    const url = `${location.origin}${location.pathname.replace("after.html","after.html")}?code=${encodeURIComponent(code)}`;
    try{
      await navigator.clipboard.writeText(url);
      toast("ë§í¬ë¥¼ ë³µì‚¬í–ˆì–´");
    }catch(e){
      const ta=document.createElement("textarea"); ta.value=url;
      document.body.appendChild(ta); ta.select(); document.execCommand("copy"); document.body.removeChild(ta);
      toast("ë§í¬ë¥¼ ë³µì‚¬í–ˆì–´");
    }
  });

  document.getElementById("btnSaveImg").addEventListener("click", async ()=>{
    const board=document.getElementById("board");
    const canvas=await html2canvas(board, {backgroundColor:null, scale:2});
    const a=document.createElement("a");
    a.download=`partyzip-guestbook-${code}.png`;
    a.href=canvas.toDataURL("image/png");
    a.click();
    toast("ì´ë¯¸ì§€ë¡œ ì €ì¥í–ˆì–´");
  });

  render();
</script>
</body>
</html>
